<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My document</title>
</head>
<body>

<div>
    <h3>Santorini</h3>
</div>
<div>
    <button onclick="btnhome()">Home</button>
    <button>Games</button>
    <button onclick="btnlogin()">Login</button>
</div>

<h1>Register user</h1>

<div id="container">
    <label for="userName" >User Name</label>
    <br>
    <input id="userName" value="abowtadaa">
    <br>
    <label for="e-mail">Your e-mail</label>
    <br>
    <input  id="e-mail">
    <br>
    <label for="e-mail-check">Write down your e-mail one more time</label>
    <br>
    <input  id="e-mail-check">
    <br>
    <label for="password">Password</label>
    <br>
    <input  id="password" value="grimstad123">
    <br>
    <button onclick="btnregisterUser()">Register</button>
</div>

<div id="feedBack"></div>



</body>

<script>
    let container = document.getElementById("container");
    function btnregisterUser () {
        let eMail = document.getElementById("e-mail");
        let eMailCheck = document.getElementById("e-mail-check");
        let userName = document.getElementById("userName");
        let password = document.getElementById("password");
        console.log(userName.value);
        console.log(password.value);

        sendRequest();

    }

    async function sendRequest() {


        if(checkUser(userName.value)) {

            let url = "http://localhost:8000/users/register";

            let updata = {
                userName: userName.value,
                eMail: "johannes@hotmail.com",
                password: password.value
            };

            let cfg = {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(updata)
            };

            try {
                let resp = await fetch(url, cfg);
                let data = await resp.text();
                //container.innerHTML = "";
                let HTML = `
            <p3>${data}</p3>
            `;
                let div = document.createElement("div");
                div.innerHTML = HTML;
                container.appendChild(div);

                console.log(data); //hello from POST
            }
            catch (err) {
                console.log(err);
            }
        }
    }

    function checkUser(input) {
        let output = input;
        if(input) {
            let whitespace = /\s/.test(input);
            if(whitespace) {
                console.log("You cant have spaces in your username!");
                return false
            }
            let slashes = /\//.test(output);
            if(slashes) {
                sendError("You cant have slashes in your username!");
                return false
            }
            let questions = /\?/.test(output);
            if(questions){
                sendError("You cant have '?' in your username!");
                return false;
            }
            let percent = /%/.test(output);
            if(percent) {
                sendError("You cant have '%' in your username!");
                return false;
            }
            if(!output) {
                sendError("Valid usernames are filtered for whitespace, forward slashes, questions marks and percent signs.");
                return null;
            }
            return true;
        }
        else {
            return null;
        }
    }

    function sendError (err) {
        console.log(err);
    }

    function btnlogin() {
        window.location.href="login.html";
    }
    function btnhome(){
        window.location.href="index.html";
    }
    /* JavaScript here... */

</script>

</html>